# ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ãƒ­ã‚°ã‚¤ãƒ³ã®ä»•çµ„ã¿ â€” æ¼”ç¿’å•é¡Œ

---

## ğŸ§  KNOWï¼ˆçŸ¥è­˜ç¢ºèªï¼‰

### KNOW-1ï¼šãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ã‚³ãƒ¼ãƒ—ã®é•ã„ã‚’ç†è§£ã—ã¦ã„ã‚‹ï¼ˆç©´åŸ‹ã‚ï¼‰

**å•é¡Œï¼š**  
æ¬¡ã®æ–‡ã®ï¼ˆAï¼‰ï¼ˆBï¼‰ã‚’åŸ‹ã‚ã‚ˆã€‚

> ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—ã¯ï¼ˆAï¼‰é–“ã§æœ‰åŠ¹ã ãŒã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ã‚³ãƒ¼ãƒ—ã¯ï¼ˆBï¼‰é–“ã§ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã•ã‚Œã‚‹ã€‚

**å›ç­”ï¼š**  
- ï¼ˆAï¼‰1å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ  
- ï¼ˆBï¼‰åŒä¸€ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

**è§£èª¬ï¼š**  
ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—ã¯1å›ã®é€šä¿¡ã§æ¶ˆãˆã‚‹ãŒã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ã‚³ãƒ¼ãƒ—ã¯ãƒ–ãƒ©ã‚¦ã‚¶å˜ä½ã§ç¶™ç¶šçš„ã«ä¿æŒã•ã‚Œã‚‹ã€‚  
ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚„ã‚«ãƒ¼ãƒˆå†…å®¹ãªã©ã«åˆ©ç”¨ã•ã‚Œã‚‹ã€‚

---

### KNOW-2ï¼šHttpSession ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’ç†è§£ã—ã¦ã„ã‚‹

**å•é¡Œï¼š**  
æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å€¤ã‚’ä¿å­˜ã™ã‚‹è¡Œã¨ã€å–å¾—ã™ã‚‹è¡Œã‚’ç­”ãˆã‚ˆã€‚

```java
session.setAttribute("loginUser", username);
String user = (String) session.getAttribute("loginUser");
```

**å›ç­”ï¼š**  
- ä¿å­˜ï¼š`session.setAttribute("loginUser", username);`  
- å–å¾—ï¼š`session.getAttribute("loginUser");`

**è§£èª¬ï¼š**  
`setAttribute()` ã¯ä¿å­˜ã€`getAttribute()` ã¯å–å¾—ã€‚  
ã‚­ãƒ¼ `"loginUser"` ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨ãƒ“ãƒ¥ãƒ¼ã‚’é€£æºã•ã›ã‚‹ã€‚

---

### KNOW-3ï¼š@SessionAttributes ã¨ @SessionAttribute ã®é•ã„ã‚’èª¬æ˜ã§ãã‚‹

**å•é¡Œï¼š**  
æ¬¡ã®ã†ã¡æ­£ã—ã„èª¬æ˜ã‚’ã™ã¹ã¦é¸ã¹ã€‚

> â‘  `@SessionAttributes` ã¯ Model ã«è¿½åŠ ã—ãŸå€¤ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã‚‚ä¿å­˜ã™ã‚‹ã€‚  
> â‘¡ `@SessionAttribute` ã¯æ—¢ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å€¤ã‚’å–å¾—ã™ã‚‹ã€‚  
> â‘¢ ä¸¡è€…ã¯å…¨ãåŒã˜å‹•ä½œã‚’ã™ã‚‹ã€‚  
> â‘£ `@SessionAttributes` ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©å˜ä½ã§æœ‰åŠ¹ã€‚

**å›ç­”ï¼š**  
â‘ ã€â‘¡ã€â‘£

**è§£èª¬ï¼š**  
`@SessionAttributes` ã¯ã€Œä¿å­˜ç”¨ã€ã€`@SessionAttribute` ã¯ã€Œå–å¾—ç”¨ã€ã€‚  
`@SessionAttributes` ã®æœ‰åŠ¹ç¯„å›²ã¯ãã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©å†…ã«é™å®šã•ã‚Œã‚‹ã€‚

---

## ğŸ‘€ READï¼ˆã‚³ãƒ¼ãƒ‰ç†è§£ï¼‰

### READ-1ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒãƒ“ãƒ¥ãƒ¼ã§ã©ã®ã‚ˆã†ã«å‚ç…§ã•ã‚Œã‚‹ã‹ã‚’èª­ã¿å–ã‚Œã‚‹

**å•é¡Œï¼š**  
æ¬¡ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å®Ÿè¡Œã—ãŸã¨ãã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ä½•ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã‹ã€‚

```java
@GetMapping("/home")
public String home(HttpSession session, Model model) {
    session.setAttribute("loginUser", "Taro");
    model.addAttribute("user", session.getAttribute("loginUser"));
    return "home";
}
```

```html
<h1>ã‚ˆã†ã“ãï¼</h1>
<p>[[${session.loginUser}]] ã•ã‚“ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã§ã™ã€‚</p>
```

**å›ç­”ï¼š**  
`ã‚ˆã†ã“ãï¼`  
`Taro ã•ã‚“ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã§ã™ã€‚`

**è§£èª¬ï¼š**  
ã‚»ãƒƒã‚·ãƒ§ãƒ³å±æ€§ `"loginUser"` ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ `${session.loginUser}` ã«ã‚ˆã‚Šå‚ç…§ã•ã‚Œã‚‹ã€‚

---

### READ-2ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ãŸãƒ­ã‚°ã‚¤ãƒ³ä¿æŒå‡¦ç†ã®æµã‚Œã‚’ç†è§£ã—ã¦ã„ã‚‹

**å•é¡Œï¼š**  
æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã®æµã‚Œã‚’èª¬æ˜ã›ã‚ˆã€‚

```java
@PostMapping("/login")
public String login(@RequestParam String username, HttpSession session) {
    session.setAttribute("loginUser", username);
    return "redirect:/home";
}
```

**å›ç­”ï¼š**  
ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å—ã‘å–ã£ãŸ `username` ã‚’ `"loginUser"` ã¨ã„ã†ã‚­ãƒ¼ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã—ã€  
`/home` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ã€‚

**è§£èª¬ï¼š**  
ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã™ã‚‹ã“ã¨ã§ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¾Œã®åˆ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿æŒã§ãã‚‹ã€‚

---

### READ-3ï¼šSessionStatus ã‚’ä½¿ã£ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³ç ´æ£„ã®ä»•çµ„ã¿ã‚’ç†è§£ã—ã¦ã„ã‚‹

**å•é¡Œï¼š**  
æ¬¡ã® `logout` ãƒ¡ã‚½ãƒƒãƒ‰ã®å‹•ä½œã‚’èª¬æ˜ã›ã‚ˆã€‚

```java
@GetMapping("/logout")
public String logout(SessionStatus status) {
    status.setComplete();
    return "redirect:/login";
}
```

**å›ç­”ï¼š**  
`@SessionAttributes` ã§ç®¡ç†ã—ã¦ã„ãŸã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ç ´æ£„ã—ã€ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸æˆ»ã‚‹ã€‚

**è§£èª¬ï¼š**  
`SessionStatus#setComplete()` ã¯ãã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«ç´ã¥ãã‚»ãƒƒã‚·ãƒ§ãƒ³å±æ€§ã‚’å‰Šé™¤ã™ã‚‹ã€‚  
`HttpSession#invalidate()` ã¨é•ã„ã€ã‚¢ãƒ—ãƒªå…¨ä½“ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç ´æ£„ã—ãªã„ã€‚

---

## âœï¸ WRITEï¼ˆå®Ÿè£…ï¼‰

### WRITE-1ï¼šHttpSession ã‚’ç”¨ã„ã¦ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚’å®Ÿè£…ã§ãã‚‹

**å•é¡Œï¼š**  
ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ãƒ›ãƒ¼ãƒ ç”»é¢ã«ã€Œâ—‹â—‹ã•ã‚“ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ãª  
ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚’å®Ÿè£…ã›ã‚ˆã€‚

**å›ç­”ï¼š**

```java
@Controller
public class LoginController {

    @PostMapping("/login")
    public String login(@RequestParam String username, HttpSession session) {
        session.setAttribute("loginUser", username);
        return "redirect:/home";
    }

    @GetMapping("/home")
    public String home(HttpSession session, Model model) {
        model.addAttribute("user", session.getAttribute("loginUser"));
        return "home";
    }
}
```

**è§£èª¬ï¼š**  
`HttpSession` ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä¿æŒã—ã€è¤‡æ•°ãƒšãƒ¼ã‚¸é–“ã§ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹ã€‚

---

### WRITE-2ï¼š@SessionAttributes ã‚’åˆ©ç”¨ã—ã¦ãƒ•ã‚©ãƒ¼ãƒ æƒ…å ±ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿æŒã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã§ãã‚‹

**å•é¡Œï¼š**  
`@SessionAttributes("form")` ã‚’ä½¿ã„ã€ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›å†…å®¹ã‚’ç¢ºèªç”»é¢ã¾ã§ä¿æŒã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚’ä½œæˆã›ã‚ˆã€‚

**å›ç­”ï¼š**

```java
@Controller
@SessionAttributes("form")
public class FormController {

    @GetMapping("/input")
    public String showForm(Model model) {
        model.addAttribute("form", new UserForm());
        return "input";
    }

    @PostMapping("/confirm")
    public String confirm(@ModelAttribute("form") UserForm form) {
        return "confirm";
    }

    @GetMapping("/complete")
    public String complete(SessionStatus status) {
        status.setComplete(); // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç ´æ£„
        return "complete";
    }
}
```

**è§£èª¬ï¼š**  
å…¥åŠ›ç”»é¢ â†’ ç¢ºèªç”»é¢ â†’ å®Œäº†ç”»é¢ã®æµã‚Œã§ã€åŒä¸€ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿æŒã§ãã‚‹ã€‚

---

### WRITE-3ï¼šã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ãŸç°¡å˜ãªã‚«ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã§ãã‚‹

**å•é¡Œï¼š**  
ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã•ã‚Œã‚‹ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã›ã‚ˆã€‚  
è¿½åŠ ãƒ»è¡¨ç¤ºãƒ»ã‚¯ãƒªã‚¢ã®3ã¤ã®æ“ä½œãŒã§ãã‚‹ã“ã¨ã€‚

**å›ç­”ï¼š**

```java
@Controller
public class CartController {

    @GetMapping("/cart")
    public String viewCart(HttpSession session, Model model) {
        List<String> cart = (List<String>) session.getAttribute("cart");
        if (cart == null) cart = new ArrayList<>();
        model.addAttribute("cart", cart);
        return "cart";
    }

    @PostMapping("/cart/add")
    public String addItem(@RequestParam String item, HttpSession session) {
        List<String> cart = (List<String>) session.getAttribute("cart");
        if (cart == null) cart = new ArrayList<>();
        cart.add(item);
        session.setAttribute("cart", cart);
        return "redirect:/cart";
    }

    @GetMapping("/cart/clear")
    public String clearCart(HttpSession session) {
        session.removeAttribute("cart");
        return "redirect:/cart";
    }
}
```

**è§£èª¬ï¼š**  
`HttpSession` ã« `cart` ã‚’ä¿å­˜ã—ã¦ãŠãã“ã¨ã§ã€ãƒªãƒ­ãƒ¼ãƒ‰ã‚„ãƒšãƒ¼ã‚¸é·ç§»ã‚’ã—ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã•ã‚Œã‚‹ã€‚
