# MyBatisã«ã‚ˆã‚‹DBã‚¢ã‚¯ã‚»ã‚¹

ã“ã®ç« ã§ã¯ã€Spring Bootã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ **MyBatis** ã‚’å­¦ã¶ã€‚  
Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãƒ»å–å¾—ã™ã‚‹ãŸã‚ã«DBã¨ã®ã‚„ã‚Šã¨ã‚ŠãŒä¸å¯æ¬ ã§ã‚ã‚Šã€  
MyBatisã‚’ä½¿ã†ã“ã¨ã§ **Javaã®ã‚¯ãƒ©ã‚¹ã¨SQLã‚’çµã³ã¤ã‘ãŸå®‰å…¨ã§æ•´ç†ã•ã‚ŒãŸDBã‚¢ã‚¯ã‚»ã‚¹** ã‚’å®Ÿç¾ã§ãã‚‹ã€‚

## å­¦ç¿’ã®ã‚´ãƒ¼ãƒ«
- MyBatisãŒã€ŒO/Rãƒãƒƒãƒ‘ãƒ¼ã€ã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã§ãã‚‹  
- `application.properties` ã«ã‚ˆã‚‹DBæ¥ç¶šè¨­å®šã‚’è¡Œãˆã‚‹  
- `schema.sql` ã¨ `data.sql` ã§ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã¨åˆæœŸãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã‚’è¡Œãˆã‚‹  
- ãƒ†ãƒ¼ãƒ–ãƒ«ã¨å¯¾å¿œã™ã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ï¼ˆJavaã‚¯ãƒ©ã‚¹ï¼‰ã‚’å®šç¾©ã§ãã‚‹  
- Mapperã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã—ã¦ã€SQLã¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚’çµã³ã¤ã‘ã‚‰ã‚Œã‚‹
- Mapperã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨XMLãƒãƒƒãƒ‘ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯¾å¿œä»˜ã‘ã€SQLã¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚’çµã³ã¤ã‘ã‚‰ã‚Œã‚‹  
- `@Mapper` ã«ã‚ˆã‚Šã€MyBatisãŒè‡ªå‹•ã§å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ä»•çµ„ã¿ã‚’ç†è§£ã§ãã‚‹  
- `resultMap` ã¨ `<collection>` ã‚’ç”¨ã„ã¦1å¯¾å¤šã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‰±ãˆã‚‹  
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰Mapperã‚’å‘¼ã³å‡ºã—ã€DBã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”»é¢è¡¨ç¤ºã¾ã§é€£æºã§ãã‚‹ 

---

## MyBatisã¨ã¯ï¼Ÿ

MyBatisã¯ **O/Rãƒãƒƒãƒ‘ãƒ¼** ã®ã²ã¨ã¤ã§ã‚ã‚‹ã€‚  

- **O/Rãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆObject-Relational Mappingï¼‰** ã¨ã¯  
  - Javaã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰ã¨ã€RDBï¼ˆãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å¯¾å¿œä»˜ã‘ã‚‹ä»•çµ„ã¿  
  - ä¾‹ï¼š`users` ãƒ†ãƒ¼ãƒ–ãƒ«ã®1è¡Œã‚’ã€`User` ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã—ã¦æ‰±ãˆã‚‹  
  - ã€ŒJavaã¨DBã¯æœ¬æ¥åˆ¥ä¸–ç•Œã®ã‚‚ã®ã€ã ãŒã€**ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡Œã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã§ããŸæ–¹ãŒä¾¿åˆ©**ã¨ã„ã†ç™ºæƒ³  

- **MyBatisã®ç‰¹å¾´**  
  - SQLã‚’è‡ªåˆ†ã§æ›¸ãã‚¹ã‚¿ã‚¤ãƒ«ã®O/Rãƒãƒƒãƒ‘ãƒ¼  
  - SQLã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹Hibernateã«æ¯”ã¹ã¦ã€å­¦ç¿’ã‚„æ¥­å‹™ã§ã¯ç†è§£ã—ã‚„ã™ãã€è‡ªç”±åº¦ãŒé«˜ã„  
  - SQLã¯ **ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³** ã§ã‚‚ **XMLãƒ•ã‚¡ã‚¤ãƒ«** ã§ã‚‚æ›¸ã‘ã‚‹  
  - å®Ÿå‹™ã§ã¯ **è¤‡é›‘ãªSQLã‚’XMLã§ç®¡ç†ã™ã‚‹ã®ãŒä¸€èˆ¬çš„**  

ğŸ‘‰ åˆå­¦è€…ã«ã¨ã£ã¦ã¯ã€**ã€ŒSQLã‚’æ›¸ãã®ã¯è‡ªåˆ†ã€‚å®Ÿè£…ã¯MyBatisãŒè‡ªå‹•ã§ã‚„ã£ã¦ãã‚Œã‚‹ã€** ã¨ã„ã†ç†è§£ã§ã‚ˆã„ã€‚

---

## DBæ¥ç¶šã®è¨­å®šï¼ˆapplication.propertiesï¼‰

Spring Bootã§ã¯ã€DBæ¥ç¶šã®è¨­å®šã‚’ `application.properties` ã«è¨˜è¿°ã™ã‚‹ã€‚  

```properties showLineNumbers
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
mybatis.mapper-locations=classpath*:mapper/*.xml
```

- `spring.datasource.url` : DBã®æ¥ç¶šå…ˆï¼ˆã“ã“ã§ã¯H2ã¨ã„ã†çµ„ã¿è¾¼ã¿DBã‚’åˆ©ç”¨ï¼‰  
- `spring.datasource.driver-class-name` : JDBCãƒ‰ãƒ©ã‚¤ãƒã®æŒ‡å®š  
- `mybatis.mapper-locations` : MyBatisã®ãƒãƒƒãƒ‘ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆSQLã‚’æ›¸ãXMLãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã®å ´æ‰€  
  - `classpath*:` â€¦ ã€Œã‚¯ãƒ©ã‚¹ãƒ‘ã‚¹ä¸Šã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ¢ã—ã¦ã­ã€ã¨ã„ã†æ„å‘³
  - `mapper/*.xml` â€¦ mapper ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹ .xml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¨éƒ¨èª­ã¿è¾¼ã‚€ã€ã¨ã„ã†æŒ‡å®š
  - å…·ä½“çš„ã«ã¯ `src/main/resources/mapper/UserMapper.xml` ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒå¯¾è±¡ã«ãªã‚‹  
  ğŸ‘‰ ã¤ã¾ã‚Šã€**`resources/mapper` ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ã„ãŸã™ã¹ã¦ã®XMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€MyBatisãŒè‡ªå‹•çš„ã«èª­ã¿è¾¼ã‚€** ã¨ã„ã†æ„å‘³ã€‚

ğŸ‘‰ æ–°äººç ”ä¿®ã§ã¯ã€Œã“ã®è¨­å®šã¯å…ˆè¼©ãŒç”¨æ„ã—ãŸã‚‚ã®ã‚’ã‚³ãƒ”ãƒšã™ã‚Œã°OKã€ã¨è€ƒãˆã¦ã‚ˆã„ã€‚  
å¤§åˆ‡ãªã®ã¯ã€**ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«DBæ¥ç¶šã‚„MyBatisã®è¨­å®šã‚’æ›¸ã**ã¨ã„ã†ã“ã¨ã€‚

---

## schema.sql ã¨ data.sql

Spring Bootã§ã¯ã€`resources` ãƒ•ã‚©ãƒ«ãƒ€ã« `schema.sql` ã¨ `data.sql` ã‚’ç½®ãã¨ã€èµ·å‹•æ™‚ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹ã€‚  

- `schema.sql` : ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã‚’è¨˜è¿°ã™ã‚‹  
- `data.sql` : åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ã™ã‚‹  

ä¾‹ï¼š  

```sql showLineNumbers title="schema.sql"
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100),
  age INT
);
```

```sql showLineNumbers title="data.sql"
INSERT INTO users (name, age) VALUES ('Taro', 20);
INSERT INTO users (name, age) VALUES ('Hanako', 25);
```

ğŸ‘‰ ã“ã®ä»•çµ„ã¿ã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ãŸã¨ãã«è‡ªå‹•çš„ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã¨åˆæœŸãƒ‡ãƒ¼ã‚¿ãŒæº–å‚™ã•ã‚Œã‚‹ã€‚

---

## ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ä½œæˆ

**ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆEntityï¼‰** ã¨ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¨1å¯¾1ã§å¯¾å¿œã™ã‚‹Javaã‚¯ãƒ©ã‚¹ã®ã“ã¨ã‚’æŒ‡ã™ã€‚  
ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã€Œ1è¡Œï¼ˆãƒ¬ã‚³ãƒ¼ãƒ‰ï¼‰ã€ã‚’Javaã®ã€Œ1ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€ã¨ã—ã¦æ‰±ã†å½¹å‰²ã‚’æŒã¤ã€‚  

ä¾‹ãˆã° `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯ã€Œidã€ã€Œnameã€ã€Œageã€ã¨ã„ã†ã‚«ãƒ©ãƒ ï¼ˆåˆ—ï¼‰ãŒã‚ã‚‹ãŒã€ã“ã‚Œã‚’Javaå´ã§ã¯ `User` ã‚¯ãƒ©ã‚¹ã® `id`ã€`name`ã€`age` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦è¡¨ç¾ã™ã‚‹ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€**SQLã®çµæœã‚’ãã®ã¾ã¾Javaã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ‰±ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚**  

```java showLineNumbers
package com.example.demo.entity;

public class User {
    private int id;
    private String name;
    private int age;

    // getter / setter
    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public int getAge() { return age; }
    public void setAge(int age) { this.age = age; }
}
```

- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ãƒ©ãƒ åã¨ä¸€è‡´ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹  
- getter / setter ã‚’å¿…ãšç”¨æ„ã™ã‚‹  

ğŸ‘‰ ã“ã‚Œã§ã€`users` ãƒ†ãƒ¼ãƒ–ãƒ«ã®1è¡Œã‚’ `User` ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã—ã¦æ‰±ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

---

## Mapperã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ãƒãƒƒãƒ‘ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«

MyBatisã§ã¯ã€SQLã‚’å‘¼ã³å‡ºã™ãŸã‚ã« **Mapperã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹** ã‚’å®šç¾©ã—ã€ãã“ã«è¨˜è¿°ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã¨SQLã‚’å¯¾å¿œä»˜ã‘ã‚‹ã€‚  
SQLã¯ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ç›´æ¥æ›¸ãã“ã¨ã‚‚ã§ãã‚‹ã—ã€XMLãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢ã—ã¦ç®¡ç†ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚  

### ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ãŸMapperï¼ˆæœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ï¼‰

```java showLineNumbers
package com.example.demo.mapper;

import com.example.demo.entity.User;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;
import java.util.List;

@Mapper
public interface UserMapper {

    @Select("SELECT id, name, age FROM users")
    List<User> findAll();

    @Select("SELECT id, name, age FROM users WHERE id = #{id}")
    User findById(int id);
}
```

- **ãƒ¡ãƒªãƒƒãƒˆ**ï¼šJavaãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã§å®Œçµã™ã‚‹ã®ã§æ‰‹è»½  
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**ï¼šSQLãŒå¢—ãˆã‚‹ã¨Javaã‚³ãƒ¼ãƒ‰ãŒèª­ã¿ã«ãããªã‚Šã€è¤‡é›‘ãªJOINã‚„æ”¹è¡Œã®å¤šã„SQLã«ã¯ä¸å‘ã  

ğŸ‘‰ å®Ÿå‹™ã§ã¯ **SQLã‚’XMLã«åˆ†é›¢ã—ã¦ç®¡ç†ã™ã‚‹æ–¹æ³•** ãŒæ¨å¥¨ã•ã‚Œã‚‹ã€‚  

---

### Mapperã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆXMLã¨å¯¾å¿œã•ã›ã‚‹ï¼‰

```java showLineNumbers
package com.example.demo.mapper;

import com.example.demo.entity.User;
import org.apache.ibatis.annotations.Mapper;
import java.util.List;

@Mapper // MyBatisãŒè‡ªå‹•ã§å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ç”Ÿæˆ
public interface UserMapper {
    List<User> findAll(); // å…¨ä»¶å–å¾—
    User findById(int id); // idã§æ¤œç´¢
}
```

- `@Mapper` ã‚’ä»˜ã‘ã‚‹ã ã‘ã§ã€å®Ÿè£…ã‚¯ãƒ©ã‚¹ã¯ä¸è¦  
- å®Ÿéš›ã®SQLã¯ **ãƒãƒƒãƒ‘ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆXMLï¼‰** ã«è¨˜è¿°ã™ã‚‹  

### ãƒãƒƒãƒ‘ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆUserMapper.xmlï¼‰

```xml showLineNumbers title="src/main/resources/mapper/UserMapper.xml"
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.mapper.UserMapper">

  <!-- Userã‚’å…¨ä»¶å–å¾— -->
  <select id="findAll" resultType="com.example.demo.entity.User">
    SELECT id, name, age FROM users
  </select>

  <!-- idã§1ä»¶æ¤œç´¢ -->
  <select id="findById" parameterType="int" resultType="com.example.demo.entity.User">
    SELECT id, name, age FROM users WHERE id = #{id}
  </select>

</mapper>
```

- `namespace` ã¯ **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Œå…¨ä¿®é£¾å** ã«ä¸€è‡´ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹  
- `<select id="findAll">` ã® `id` ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰åã¨ä¸€è‡´ã•ã›ã‚‹  
- `resultType` ã§è¿”ã‚Šå€¤ã®ã‚¯ãƒ©ã‚¹ã‚’æŒ‡å®š  

ğŸ‘‰ ã“ã‚Œã«ã‚ˆã‚Šã€Javaå´ã® `UserMapper.findAll()` ã‚’å‘¼ã¶ã¨SQLãŒå®Ÿè¡Œã•ã‚Œã€çµæœãŒ `User` ã®ãƒªã‚¹ãƒˆã¨ã—ã¦è¿”ã‚‹ã€‚  

---

## ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§åˆ©ç”¨ã™ã‚‹

ä½œæˆã—ãŸ `UserMapper` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰å‘¼ã³å‡ºã—ã¦ã¿ã‚ˆã†ã€‚  

```java showLineNumbers
package com.example.demo.controller;

import com.example.demo.mapper.UserMapper;
import com.example.demo.entity.User;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import java.util.List;

@Controller
public class UserController {

    private final UserMapper userMapper;

    // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
    public UserController(UserMapper userMapper) {
        this.userMapper = userMapper;
    }

    @GetMapping("/users")
    public String list(Model model) {
        List<User> users = userMapper.findAll();
        model.addAttribute("users", users);
        return "user-list";
    }
}
```

- `@Mapper` ã‚’ä»˜ã‘ãŸ `UserMapper` ã¯ã€SpringãŒè‡ªå‹•ã§Beanç™»éŒ²ã—ã¦ãã‚Œã‚‹  
- `@Autowired` ã‚’æ˜ç¤ºã—ãªãã¦ã‚‚ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã§åˆ©ç”¨å¯èƒ½  
- `userMapper.findAll()` ã‚’å‘¼ã¶ã¨ã€`UserMapper.xml` ã®SQLãŒå®Ÿè¡Œã•ã‚Œã‚‹  

ğŸ‘‰ **ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©å´ã¯SQLã‚’æ„è­˜ã›ãšã€ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã ã‘ã§DBã‚¢ã‚¯ã‚»ã‚¹ãŒã§ãã‚‹ã€‚**  

---

## 1å¯¾å¤šã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‰±ã†ï¼ˆUserã¨Postï¼‰

`User` ã«é–¢é€£ã™ã‚‹ `Post` ã‚’ä¸€ç·’ã«å–å¾—ã™ã‚‹ä¾‹ã‚’è¦‹ã¦ã¿ã‚ˆã†ã€‚  
ã“ã“ã§ã¯ã€**Userï¼ˆ1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ã«å¯¾ã—ã¦è¤‡æ•°ã®Postï¼ˆæŠ•ç¨¿ï¼‰ãŒå­˜åœ¨ã™ã‚‹** ã¨ã„ã†é–¢ä¿‚ã‚’æ‰±ã†ã€‚  

### ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å®šç¾©

ã¾ãšã¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã™ã‚‹ã€‚  
`User` ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã¯ `List<Post>` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒãŸã›ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç´ã¥ãæŠ•ç¨¿ã‚’ä¿æŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚  

```java showLineNumbers
package com.example.demo.entity;

import java.util.List;

public class User {
    private int id;
    private String name;
    private int age;

    // 1å¯¾å¤šã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®æŠ•ç¨¿ã‚’æŒã¤ï¼‰
    private List<Post> posts;

    // getter / setter
    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public int getAge() { return age; }
    public void setAge(int age) { this.age = age; }

    public List<Post> getPosts() { return posts; }
    public void setPosts(List<Post> posts) { this.posts = posts; }
}
```

```java showLineNumbers
package com.example.demo.entity;

public class Post {
    private int id;
    private int userId;
    private String content;

    // getter / setter
    public int getId() { return id; }
    public void setId(int id) { this.id = id; }

    public int getUserId() { return userId; }
    public void setUserId(int userId) { this.userId = userId; }

    public String getContent() { return content; }
    public void setContent(String content) { this.content = content; }
}
```

ğŸ‘‰ ã“ã‚Œã§ã€`User` ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ `posts` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é€šã˜ã¦ã€è‡ªåˆ†ã«ç´ã¥ãæŠ•ç¨¿ä¸€è¦§ã‚’æŒã¦ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚  

---

### Mapperã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```java showLineNumbers
package com.example.demo.mapper;

import com.example.demo.entity.User;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface UserMapper {
    User findUserWithPosts(int id);
}
```

### XMLãƒãƒƒãƒ‘ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«

```xml showLineNumbers title="src/main/resources/mapper/UserMapper.xml"
<mapper namespace="com.example.demo.mapper.UserMapper">

  <resultMap id="UserWithPostsResultMap" type="com.example.demo.entity.User">
    <id property="id" column="id"/>
    <result property="name" column="name"/>
    <result property="age" column="age"/>
    <collection property="posts" ofType="com.example.demo.entity.Post">
      <id property="id" column="post_id"/>
      <result property="userId" column="user_id"/>
      <result property="content" column="content"/>
    </collection>
  </resultMap>

  <select id="findUserWithPosts" parameterType="int" resultMap="UserWithPostsResultMap">
    SELECT u.id, u.name, u.age,
           p.id AS post_id, p.user_id, p.content
    FROM users u
    LEFT JOIN posts p ON u.id = p.user_id
    WHERE u.id = #{id}
  </select>
</mapper>
```

- `resultMap` ã‚’ä½¿ã†ã¨ã€JOINçµæœã‚’ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã§ãã‚‹  
- `<collection>` ã«ã‚ˆã£ã¦ã€`List<Post>` ã‚’ `User` ã«æ ¼ç´ã§ãã‚‹  

---

## ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§åˆ©ç”¨ã™ã‚‹

```java showLineNumbers
package com.example.demo.controller;

import com.example.demo.mapper.UserMapper;
import com.example.demo.entity.User;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class UserController {

    private final UserMapper userMapper;

    public UserController(UserMapper userMapper) {
        this.userMapper = userMapper;
    }

    @GetMapping("/user-detail")
    public String detail(Model model) {
        User user = userMapper.findUserWithPosts(1);
        model.addAttribute("user", user);
        return "user-detail";
    }
}
```

- `findUserWithPosts(1)` ã‚’å‘¼ã¶ã¨ã€`users` ã¨ `posts` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’çµåˆã—ãŸçµæœãŒè¿”ã‚‹  
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§ã¯ `user.getPosts()` ã§æŠ•ç¨¿ãƒªã‚¹ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹  

---

ğŸ‘‰ ã¾ã¨ã‚  
- ç°¡å˜ãªSQLã¯ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§æ›¸ã‘ã‚‹  
- å®Ÿå‹™ã§ã¯SQLã‚’XMLã«åˆ†é›¢ã—ã€Mapperã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨å¯¾å¿œä»˜ã‘ã‚‹  
- `resultMap` ã¨ `<collection>` ã‚’ä½¿ã†ã¨ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒã¤ãƒ‡ãƒ¼ã‚¿ã‚‚æ‰±ãˆã‚‹  

---

## æœ¬ç« ã®ã¾ã¨ã‚

- MyBatisã¯ **O/Rãƒãƒƒãƒ‘ãƒ¼** ã®ã²ã¨ã¤ã§ã€SQLã‚’è‡ªåˆ†ã§æ›¸ã‘ã‚‹ã®ãŒç‰¹å¾´  
- `application.properties` ã§DBæ¥ç¶šã‚’è¨­å®šã™ã‚‹  
- `schema.sql` ã¨ `data.sql` ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã¨åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ã§ãã‚‹  
- ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆJavaã‚¯ãƒ©ã‚¹ï¼‰ã‚’ä½œã‚Šã€ãƒ†ãƒ¼ãƒ–ãƒ«ã®1è¡Œã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æ‰±ãˆã‚‹  
- Mapperã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨XMLãƒãƒƒãƒ‘ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€Javaãƒ¡ã‚½ãƒƒãƒ‰ã¨SQLã‚’çµã³ã¤ã‘ã‚‹  
- `@Mapper` ã‚’ä»˜ã‘ã‚‹ã¨ã€MyBatisãŒè‡ªå‹•ã§å®Ÿè£…ã‚¯ãƒ©ã‚¹ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹  
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§ã¯ã€Mapperã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã¶ã ã‘ã§DBã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã«ãªã‚‹  

---

